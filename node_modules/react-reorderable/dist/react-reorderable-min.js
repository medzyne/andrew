!function(e,t){"function"==typeof define&&define.amd?define(["React","ReactDrag"],t):"object"==typeof exports?module.exports=t(require("react/addons"),require("react-drag")):e.ReactReorderable=t(e.React,e.ReactDrag)}(this,function(e,t){"use strict";function r(e){for(;e;){if(e.className&&e.className.indexOf("react-reorderable-item")>=0)return e;e=e.parentNode}return null}function n(e){var t=e.touches&&e.touches[0]||e;return{clientX:t.clientX,clientY:t.clientY}}function o(e,t){var r=t.getBoundingClientRect(),o=r.top,a=r.left,i=r.width,s=r.height,c=n(e);return c.clientY<o||c.clientY>o+s?u.NONE:c.clientX>a&&c.clientX<a+.5*i?u.NEXT:c.clientX>a+.5*i&&c.clientX<a+i?u.PREVIOUS:u.NONE}function a(e,t){var r=t.getBoundingClientRect(),o=r.top,a=r.left,i=r.width,s=r.height,c=n(e);return c.clientX<a||c.clientX>a+i?u.NONE:c.clientY>o&&c.clientY<o+.5*s?u.NEXT:c.clientY>o+.5*s&&c.clientY<o+s?u.PREVIOUS:u.NONE}function i(e,t,r){var n,i=t.parentNode,s=i.children,c=!1,l={};r=r||"list";for(var d=0;d<s.length&&!c;d+=1)if(n=s[d],n.getAttribute("data-reorderable-key")!==t.getAttribute("data-reorderable-key")){var h;if(h="list"===r?a(e,n):o(e,n),h!==u.NONE)return l.node=n,l.type=h,l}return l}function s(t){for(var r,n="node-",o={},a=[],i=0;i<t.length;i+=1){var r=n+(i+1);a.push(r),t[i]=e.createElement("div",{className:"react-reorderable-item",key:r,"data-reorderable-key":r},t[i]),o[r]=t[i]}return{map:o,ids:a}}function c(e,t){for(var r=e.parentNode.querySelectorAll(t),n=0;n<r.length;n+=1)if(e===r[n])return!0;return!1}function l(e,t,r){var n=e.getAttribute("data-reorderable-key"),o=r.indexOf(n);r.splice(o,1);var a=t.node.getAttribute("data-reorderable-key"),i=r.indexOf(a);return t.type===u.PREVIOUS?r.splice(i+1,0,n):r.splice(i,0,n),r}var u={NONE:0,NEXT:1,PREVIOUS:2},d=e.createClass({displayName:"ReactReorderable",componentWillMount:function(){window.addEventListener("mouseup",this._mouseupHandler=function(){this.setState({mouseDownPosition:null})}.bind(this))},componentWillUnmount:function(){window.removeEventListener("mouseup",this._mouseupHandler)},componentWillReceiveProps:function(e){if(e.children){var t=s(e.children);this.setState({order:t.ids,reorderableMap:t.map})}},getInitialState:function(){var e=s(this.props.children);return{order:e.ids,startPosition:null,activeItem:null,reorderableMap:e.map}},onDragStop:function(e){this.setState({activeItem:null,startPosition:null}),this.props.onDrop(this.state.order.map(function(e){return this.state.reorderableMap[e].props.children},this))},onDrag:function(e){var t=this.refs.handle.getDOMNode(),n=i(e,t,this.props.mode);if(n&&n.node){for(var o=this.state.order.slice(),a=l(r(t),n,this.state.order),s=!1,c=0;c<a.length&&!s;c+=1)a[c]!==o[c]&&(s=!0);s&&this.props.onChange(this.state.order.map(function(e){return this.state.reorderableMap[e].props.children},this)),this.setState({order:a})}},onMouseDown:function(e){var t;(!this.props.handle||c(e.target,this.props.handle))&&(t=n(e),this.setState({mouseDownPosition:{x:t.clientX,y:t.clientY}}))},onTouchStart:function(e){e.preventDefault(),this.onMouseDown(e)},onMouseMove:function(e){var t;if(!this.state.activeItem){var o=this.state.mouseDownPosition;if(!o)return;if(t=n(e),Math.abs(t.clientX-o.x)>=5||Math.abs(t.clientY-o.y)>=5){var a=r(e.target),i=e.nativeEvent,s=a.getAttribute("data-reorderable-key");this.props.onDragStart(this.state.reorderableMap[s]),this.activeItem=a;var c=a.parentNode&&a.parentNode.parentNode;this.setState({mouseDownPosition:null,activeItem:s,startPosition:{x:a.offsetLeft-(c&&c.scrollLeft||0),y:a.offsetTop-(c&&c.scrollTop||0)}},function(){this.refs.handle.handleDragStart(i)}.bind(this))}}},render:function(){var r,n=this.state.order.map(function(t){var r=this.state.activeItem?"noselect ":"";return this.state.activeItem===t&&(r+="react-reorderable-item-active"),e.addons.cloneWithProps(this.state.reorderableMap[t],{key:"reaorderable-"+t,ref:"active",onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onTouchStart:this.onTouchStart,onTouchMove:this.onMouseMove,className:r})},this);if(this.state.activeItem){var o=this.state.startPosition;r=e.addons.cloneWithProps(this.state.reorderableMap[this.state.activeItem],{className:"react-reorderable-handle"}),r=e.createElement(t,{onStop:this.onDragStop,onDrag:this.onDrag,ref:"handle",start:{x:o.x,y:o.y}},r)}return e.createElement("div",{ref:"wrapper"},n,r)}});return d.propTypes={onDragStart:e.PropTypes.func,onDrag:e.PropTypes.func,onDrop:e.PropTypes.func,onChange:e.PropTypes.func},d.defaultProps={onDragStart:function(){},onDrag:function(){},onDrop:function(){},onChange:function(){}},d});